## Задача: нахождение количества пересекающихся прямоугольников в точке

### Три алгоритма реализации: 

#### 1. [Полный перебор](#алгоритм-перебора)
#### 2. [Построение карты](#алгоритм-на-карте)
#### 3. [Построение персистентного дерева отрезков](#алгоритм-на-дереве)

---

### Генерация данных

  - Генерация прямоугольников 

    **Формула:** `{[10*i, 10*i], [10*(2N-i), 10*(2N-i)]}`

  https://github.com/ProbablyDead/algorithm_lab_2/blob/98546d58aee0075d551294138ed03db991e6d889/benchmark/Generator.java#L18-L24

  - Генерация точек 

    **Формула для одной из координат:** `(p*i)^31%(20*N)`
    > Где p - случайное большое простое число   
    > Получение p:
    > https://github.com/ProbablyDead/algorithm_lab_2/blob/98546d58aee0075d551294138ed03db991e6d889/benchmark/Generator.java#L36-L40

    - Получение простых чисел в заданном диапазоне

    https://github.com/ProbablyDead/algorithm_lab_2/blob/98546d58aee0075d551294138ed03db991e6d889/benchmark/Generator.java#L42-L61

    - Генерация точек

  https://github.com/ProbablyDead/algorithm_lab_2/blob/98546d58aee0075d551294138ed03db991e6d889/benchmark/Generator.java#L26-L34

### Алгоритм перебора

  Перебор каждого прямоугольника и определение принадлежности к нему точки

 **Сложность:** подготовка - `O(1)`, поиск - `O(N)`

https://github.com/ProbablyDead/algorithm_lab_2/blob/8165bf9d053cef19ed174d3da16ebefa9faf907c/algorithms/solution/FirstAlgorithm.java#L37-L46

  > Определение принадлежности
  > 
  > https://github.com/ProbablyDead/algorithm_lab_2/blob/d97afbfb6c46e2c8002b4b9d70ea0a808f26886c/algorithms/solution/Rectangle.java#L29-L31

### Алгоритм на карте
 
  Построение карты по сжатым координатам и поиск таковых в массиве с помощью бинарного поиска

  **Сложность:** подготовка - `O(N^3)`, поиск - `O(log(N))`

  - Создание отсортированного [массива](#создание-отсортированного-массива-уникальных-сжатых-координат) уникальных сжатых координат 

    > Добавление уникального значения
    > https://github.com/ProbablyDead/algorithm_lab_2/blob/8165bf9d053cef19ed174d3da16ebefa9faf907c/algorithms/solution/Rectangle.java#L18-L22

    > Добавление координаты `(x2 + 1, y2 + 1)` нужно для возможности поиска сжатой координаты бинарным поиском со смещением влево

  - Создание карты

    https://github.com/ProbablyDead/algorithm_lab_2/blob/8165bf9d053cef19ed174d3da16ebefa9faf907c/algorithms/solution/SecondAlgorithm.java#L68-L85

  - Поиск количества пересечений

    https://github.com/ProbablyDead/algorithm_lab_2/blob/8165bf9d053cef19ed174d3da16ebefa9faf907c/algorithms/solution/SecondAlgorithm.java#L26-L35

  - [Бинарный поиск](#бинарный-поиск)

### Алгоритм на дереве

  Построение персистентного дерева отрезков и последующий поиск значения в массиве деревьев по сжатым координатам точки 
  
  **Сложность:** подготовка - `O(Nlog(N))`, поиск - `O(log(N))`
  
  - Создание отсортированного [массива](#создание-отсортированного-массива-уникальных-сжатых-координат) уникальных сжатых координат 

  - Построение пустого дерева отрезков 

    https://github.com/ProbablyDead/algorithm_lab_2/blob/5cb0855981afb0245c61ca32746066fd3d78f35f/algorithms/solution/Node.java#L71-L84

  - Создание отсортированного массива с вертикальными сторонами прямоугольников

    https://github.com/ProbablyDead/algorithm_lab_2/blob/5cb0855981afb0245c61ca32746066fd3d78f35f/algorithms/solution/Rectangle.java#L47-L55

    > Класс стороны
    > https://github.com/ProbablyDead/algorithm_lab_2/blob/5cb0855981afb0245c61ca32746066fd3d78f35f/algorithms/solution/Rectangle.java#L33-L45

    *Таким образом*, мы упорядочиваем стороны всех заданных прямоугольников, что позволяет последовательно добавлять их в дерево отрезков

  - Добавление сторон в дерево отрезков

    https://github.com/ProbablyDead/algorithm_lab_2/blob/5cb0855981afb0245c61ca32746066fd3d78f35f/algorithms/solution/Node.java#L35-L69 

  - Поиск количества пересечений

    https://github.com/ProbablyDead/algorithm_lab_2/blob/5cb0855981afb0245c61ca32746066fd3d78f35f/algorithms/solution/Node.java#L86-L99

> ### Использованные алгоритмы
>
>  ##### Создание отсортированного массива уникальных сжатых координат 
>    https://github.com/ProbablyDead/algorithm_lab_2/blob/8165bf9d053cef19ed174d3da16ebefa9faf907c/algorithms/solution/SecondAlgorithm.java#L47-L66
>
>  ##### Бинарный поиск
> https://github.com/ProbablyDead/algorithm_lab_2/blob/8165bf9d053cef19ed174d3da16ebefa9faf907c/algorithms/solution/Point.java#L14-L29

### Замеры, графики и итоговые результаты

  Замеры производились для N прямоугольников и N точек, где N = 2^m | m ∈ [0, 17]

  #### [Полный перебор](#алгоритм-перебора)

  |Points and rectangles count|Build time|Request time|Total time|Units|
  |-|-|-|-|-|
  |1| 1176959| 216750| 3282500| ns.|
  |2| 471666| 104667| 685500| ns.|
  |4| 485541| 123667| 699041| ns.|
  |8| 557708| 180083| 856708| ns.||
  |16| 525125| 193292| 816708| ns.|
  |32| 602875| 240625| 946875| ns.|
  |64| 416875| 243375| 774042| ns.|
  |128| 527500| 572750| 1199916| ns.|
  |256| 584833| 1539083| 2229292| ns.|
  |512| 747667| 1508917| 2386625| ns.|
  |1024| 1452584| 2944958| 4498875| ns.|
  |2048| 2464375| 8536792| 11114458| ns.|
  |4096| 4579459| 30248542| 34967042| ns.|
  |8192| 9922875| 111509125| 121550792| ns.|
  |16384| 18970041| 426025875| 445099125| ns.|
  |32768| 37539792| 2406956792| 2444625458| ns.|
  |65536| 72175333| 23443346541| 23515699000| ns.|
  |131072| 149201333| 167119576542| 167268896917| ns.|

  #### [Построение карты](#алгоритм-на-карте)

  |Points and rectangles count|Build time|Request time|Total time|Units|
  |-|-|-|-|-|
  |1| 505875| 70000| 785041| ns.|
  |2| 463000| 127541| 657083| ns.|
  |4| 607542| 147791| 808625| ns.|
  |8| 1104916| 112666| 1295250| ns.|
  |16| 2380666| 131500| 2565750| ns.|
  |32| 12844709| 297458| 13202875| ns.|
  |64| 182171334| 181500| 182409667| ns.|
  |128| 2644207458| 311625| 2644574167| ns.|
  |256| 40747956125| 546500| 40748566583| ns.|
  |512| 639829100375| 620542| 639829778250| ns.|
  |1024| 10132711556916| 1011625| 10132712638500| ns.|

  #### [Персистентное ДО](#алгоритм-на-дереве)

  |Points and rectangles count|Build time|Request time|Total time|Units|
  |-|-|-|-|-|
  |1| 1199917| 85750| 1569417| ns.|
  |2| 382792| 97292| 539000| ns.|
  |4| 392000| 81084| 536750| ns.|
  |8| 515416| 113500| 684875| ns.|
  |16| 613375| 125958| 792583| ns.|
  |32| 541250| 115625| 729375| ns.|
  |64| 728250| 136750| 992000| ns.|
  |128| 1135750| 236459| 1485500| ns.|
  |256| 1809917| 382625| 2322041| ns.|
  |512| 4244083| 560625| 4928250| ns.|
  |1024| 12594292| 959834| 13682792| ns.|
  |2048| 46607083| 1844834| 48516000| ns.|
  |4096| 167554334| 3984709| 171615833| ns.|
  |8192| 627493458| 7254584| 634838875| ns.|
  |16384| 2392682000| 13637375| 2406423125| ns.|
  |32768| 11064017292| 25892167| 11090060833| ns.|
  |65536| 71259689667| 48692958| 71308478583| ns.|
  |131072| 441109001708| 126344000| 441235440708| ns.|

  #### Графики

###Выводы

